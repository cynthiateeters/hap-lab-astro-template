---
/**
 * CodeBlock.astro - Wrapper for Astro's Code component with HAP theme
 *
 * Uses css-variables theme for HAP custom styling via shiki-hap-theme.css
 * Includes copy button functionality
 *
 * Usage:
 *   <CodeBlock code={`your code here`} lang="css" />
 *
 * Supported languages: html, css, javascript, json, markdown, bash, text, nunjucks
 */

import { Code } from 'astro:components';

interface Props {
  code: string;
  lang: string;
}

const { code, lang } = Astro.props;
---

<div class='code-block-wrapper'>
  <Code code={code} lang={lang} theme='min-light' />
  <button class='copy-button' aria-label='Copy code to clipboard'>Copy</button>
</div>

<script>
  // Add copy functionality to all code blocks
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.code-block-wrapper').forEach((wrapper) => {
      const button = wrapper.querySelector('.copy-button');
      const codeBlock = wrapper.querySelector('pre');

      if (button && codeBlock) {
        button.addEventListener('click', async () => {
          const code = codeBlock.textContent || '';
          try {
            await navigator.clipboard.writeText(code);
            button.classList.add('copied');
            button.textContent = 'Copied';
            setTimeout(() => {
              button.classList.remove('copied');
              button.textContent = 'Copy';
            }, 2000);
          } catch (err) {
            console.error('Failed to copy:', err);
          }
        });
      }
    });
  });
</script>
